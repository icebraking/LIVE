<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICE BRAKERS — 2025 F1 SCHEDULE</title>

  <link rel="icon" type="image/png" href="favicon.png">

  <style>
    /* Basic look to match your other pages: pure black, white Copperplate, uppercase */
    @supports (font-family: "Copperplate Gothic") {
      :root { --main-font: "Copperplate Gothic","Copperplate","Copperplate Gothic Bold",serif; }
    }
    :root {
      --bg:#000;
      --fg:#fff;
      --muted: rgba(255,255,255,0.06);
      --accent: #FF0000;
      --card-radius: 12px;
      --gap:16px;

      /* Title sizing for fixed top title */
      --title-height: 64px;
    }
    html,body {
      height:100%;
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--fg);
      font-family: var(--main-font, "Copperplate Gothic", "Copperplate", serif);
      text-transform: uppercase;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:auto;
    }
    a { color: inherit; text-decoration: none; }

    /* Fixed centered page title - pinned to the very top so it never moves when scrolling */
    .page-title {
      position: fixed;
      top: 0; /* pinned to the top of the viewport */
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999; /* high so content scrolls beneath it */
      margin: 0;
      padding: 14px 16px;
      height: var(--title-height);
      line-height: calc(var(--title-height) - 4px);
      font-size: clamp(18px, 3.6vw, 28px);
      font-weight: 800;
      color: var(--fg);
      pointer-events: none; /* non-interactive */
      text-align: center;
      letter-spacing: 0.6px;
      background: rgba(0,0,0,1); /* solid background so it visually stays in place */
      white-space: nowrap;
      box-sizing: border-box;
      width: 100%;
      max-width: 100%;
    }

    .wrap {
      max-width:1100px;
      /* leave room for the fixed title at top so content is not hidden under it */
      margin: calc(1.2rem + var(--title-height)) auto 64px auto;
      padding: 18px;
      box-sizing:border-box;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.002));
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: var(--card-radius);
      padding: 8px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    /* Table-like list to allow expandable rows easily */
    .schedule {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      display:block;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 220px;
      gap: 12px;
      align-items: center;
      padding: 18px;
      border-radius: 10px;
      background: transparent;
      transition: background .15s, transform .12s;
      cursor: default; /* changed to default since rows no longer expand */
      user-select: none;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.03);
    }
    .row:hover, .row:focus {
      background: rgba(255,255,255,0.02);
      transform: translateY(-2px);
    }

    .left {
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .track {
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--fg);
    }
    .place {
      font-size: 0.88rem;
      color: rgba(255,255,255,0.78);
      font-weight:700;
    }

    .right {
      text-align: right;
      font-weight:700;
    }
    .period {
      font-size: 0.98rem;
      color: var(--fg);
    }

    /* Expanded details CSS left in place but not used (no JS will toggle it) */
    .details {
      overflow: hidden;
      max-height: 0;
      transition: max-height .28s cubic-bezier(.2,.9,.2,1), padding .18s;
      background: rgba(255,255,255,0.01);
      margin-bottom: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.02);
    }
    .details.open {
      padding: 12px;
    }

    .sessions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .session {
      padding: 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.02);
      font-weight:700;
      font-size: 0.95rem;
    }
    .session .name { color: var(--fg); font-size: 0.88rem; }

    .loading, .error {
      margin: 18px 0;
      padding: 18px;
      border-radius: 8px;
      background: rgba(255,255,255,0.02);
      color: var(--fg);
      font-weight:700;
    }

    /* Home button in-flow (not fixed) placed at the bottom-left of the content */
    .home-wrap {
      display: flex;
      justify-content: flex-start;
      margin-top: 1cm; /* space below content */
      padding-left: 4px;
    }
    .home-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 52px;
      height: 52px;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      color: #FFFFFF;
      text-decoration: none;
      border: 0;
      transition: transform .12s ease, background .12s ease;
    }
    .home-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.05); }
    .home-btn svg { width: 24px; height: 24px; fill: currentColor; }

    /* Accessible focus styles */
    .row:focus { outline: 3px solid rgba(255,0,0,0.12); outline-offset: 4px; }
    button.expand-btn { background: transparent; border: none; color: inherit; font: inherit; cursor: pointer; padding:0; margin:0; display:block; width:100%; text-align:inherit; }

    /* Responsive */
    @media (max-width:720px) {
      .row { grid-template-columns: 1fr 160px; padding:14px; }
      .right { text-align: right; }
    }
    @media (max-width:420px) {
      .wrap { margin-top: calc(1rem + var(--title-height)); padding: 12px; }
      .row { grid-template-columns: 1fr; text-align: left; padding:14px; }
      .right { text-align: left; margin-top:8px; }
      .sessions { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Fixed centered page title -->
  <h1 class="page-title">2025 F1 SCHEDULE</h1>

  <div class="wrap">
    <div id="status" class="loading card">Loading 2025 schedule…</div>

    <div id="list" class="card" aria-live="polite" style="display:none;">
      <div id="schedule" class="schedule" role="list"></div>
    </div>

    <!-- Home button in normal flow; it moves with the page (not fixed) and links to index.html -->
    <div class="home-wrap">
      <a href="index.html" class="home-btn" aria-label="Home">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M12 3l9 8h-3v7a1 1 0 0 1-1 1h-4v-5H11v5H7a1 1 0 0 1-1-1v-7H3l9-8z" />
        </svg>
      </a>
    </div>
  </div>

  <script>
    (function(){
      // Primary endpoint (HTTPS) — jolpi proxy for Ergast calendar
      const PRIMARY_API = 'https://api.jolpi.ca/ergast/f1/current.json';
      // Fallback: AllOrigins proxy to fetch Ergast raw URL (helps around CORS if the primary is unavailable)
      const FALLBACK_PROXY = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://ergast.com/api/f1/current.json');

      const statusEl = document.getElementById('status');
      const listWrap = document.getElementById('list');
      const scheduleEl = document.getElementById('schedule');

      function fmtDateShort(iso) {
        try {
          if (!iso) return 'TBA';
          const d = new Date(iso);
          if (Number.isNaN(d.getTime())) return 'TBA';
          const month = d.toLocaleString(undefined, { month: 'short' }).toUpperCase();
          const day = d.getDate();
          return `${month} ${day}`;
        } catch (e) { return 'TBA'; }
      }

      function fmtDateRangeSingle(startISO, endISO) {
        try {
          if (!startISO || !endISO) return 'TBA';
          const s = new Date(startISO);
          const e = new Date(endISO);
          if (Number.isNaN(s.getTime()) || Number.isNaN(e.getTime())) return 'TBA';
          if (s.getFullYear() === e.getFullYear() && s.getMonth() === e.getMonth() && s.getDate() === e.getDate()) {
            return fmtDateShort(startISO);
          }
          const sShort = fmtDateShort(startISO);
          const eShort = fmtDateShort(endISO);
          return `${sShort} - ${eShort}`;
        } catch (e) {
          return 'TBA';
        }
      }

      function createRow(meeting, idx) {
        const trackName = meeting.raceName || 'Unknown Track';
        const place = (meeting.Circuit && (meeting.Circuit.Location && (meeting.Circuit.Location.locality || meeting.Circuit.Location.country))) || '';
        const startDate = meeting.date || meeting.raceDate || null;
        const endDate = startDate;
        const period = fmtDateRangeSingle(startDate, endDate);

        const container = document.createElement('div');
        container.className = 'row';
        container.tabIndex = -1; // not interactive anymore
        container.setAttribute('role','listitem');
        container.dataset.index = idx;

        const left = document.createElement('div');
        left.className = 'left';
        const t = document.createElement('div');
        t.className = 'track';
        t.textContent = (trackName || '').toUpperCase();
        const p = document.createElement('div');
        p.className = 'place';
        p.textContent = (place || '').toUpperCase();
        left.appendChild(t); left.appendChild(p);

        const right = document.createElement('div');
        right.className = 'right';
        const per = document.createElement('div');
        per.className = 'period';
        per.textContent = (period || '').toUpperCase();
        right.appendChild(per);

        container.appendChild(left); container.appendChild(right);

        // Note: expansion/details have been removed per request — no click/keyboard handlers are attached.

        return container;
      }

      function renderRaces(races) {
        scheduleEl.innerHTML = '';
        if (!Array.isArray(races) || !races.length) {
          statusEl.className = 'error card';
          statusEl.textContent = 'No races found in the API response';
          listWrap.style.display = 'none';
          return;
        }
        statusEl.style.display = 'none';
        listWrap.style.display = 'block';
        races.forEach((r, idx) => {
          const container = createRow(r, idx);
          scheduleEl.appendChild(container);
        });
      }

      const CACHE_KEY = 'ergast_current_2025_calendar_v1';
      const CACHE_TTL = 60 * 5; // 5 minutes

      async function fetchJson(url, opts = {}) {
        const res = await fetch(url, Object.assign({ method: 'GET', mode: 'cors' }, opts));
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return res.json();
      }

      async function load() {
        try {
          // try cache first
          const raw = localStorage.getItem(CACHE_KEY);
          if (raw) {
            const parsed = JSON.parse(raw);
            if (parsed && parsed.ts && (Date.now()/1000 - parsed.ts < CACHE_TTL)) {
              renderRaces(parsed.data);
              return;
            }
          }

          statusEl.className = 'loading card';
          statusEl.textContent = 'Fetching calendar (primary)...';

          // Primary attempt - secure jolpi proxy (HTTPS). This should work in most deployments.
          try {
            const json = await fetchJson(PRIMARY_API);
            const races = (json && json.MRData && json.MRData.RaceTable && json.MRData.RaceTable.Races) ? json.MRData.RaceTable.Races : [];
            try { localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Math.floor(Date.now()/1000), data: races })); } catch (e) {}
            renderRaces(races);
            return;
          } catch (primaryErr) {
            console.warn('Primary fetch failed:', primaryErr);
            // continue to fallback
          }

          // Fallback attempt - AllOrigins proxy fetch of the official Ergast http URL.
          statusEl.className = 'loading card';
          statusEl.textContent = 'Primary failed; attempting fallback proxy...';

          try {
            const json = await fetchJson(FALLBACK_PROXY);
            const races = (json && json.MRData && json.MRData.RaceTable && json.MRData.RaceTable.Races) ? json.MRData.RaceTable.Races : [];
            try { localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Math.floor(Date.now()/1000), data: races })); } catch (e) {}
            renderRaces(races);
            return;
          } catch (fallbackErr) {
            console.warn('Fallback fetch failed:', fallbackErr);
            throw new Error('Failed to fetch calendar (primary and fallback failed). Check network or CORS.');
          }

        } catch (err) {
          console.error(err);
          statusEl.className = 'error card';
          // Show a clearer message advising likely causes (network, CORS, or proxy down).
          statusEl.textContent = 'Failed to load calendar — ' + (err && err.message ? err.message : 'network error');
          listWrap.style.display = 'none';
        }
      }

      load();
    })();
  </script>
</body>
</html>