<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ICE Braking | F1 Standings</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root {
      --background: #FF89C4;
      --tab-selected-font: #FFFFFF;
      --tab-unselected-font: #FFFFFF;
      --tab-bg: rgba(255,255,255,0.17);
      --tab-selected-bg: #C7007F;
      --tab-hover-bg: #B30073;
      --card-bg: rgba(255,255,255,0.07);
      --table-bg: #DE5C9A;
      --row-even: #DE5C9A;
      --row-odd: #B30073;
      --row-accent: #C7007F;
      --accent: #FFFFFF;
      --title-shadow: 0 0 10px #C7007F, 0 2px 6px #B30073;
      --futuristic-gradient: linear-gradient(90deg, #FFFFFF 10%, #FF89C4 60%, #DE5C9A 90%);
      --futuristic-shadow: 0 0 18px #C7007F66, 0 0 36px #B3007333, 0 0 54px #DE5C9A66;
    }
    body {
      margin: 0;
      background: var(--background);
      color: #fff;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      min-height: 100vh;
      letter-spacing: 0.03em;
      transition: background 0.3s;
    }
    header {
      text-align: center;
      padding: 90px 1rem 0.5rem 1rem;
      margin-top: 0;
      margin-bottom: 0;
    }
    .ice-scatter {
      font-size: 2rem;
      font-weight: 900;
      font-style: italic;
      letter-spacing: -0.09em;
      margin: 0 0 0.3rem 0;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      border-radius: 14px;
      padding: 0.12rem 0.4rem;
      display: inline-block;
      box-shadow: var(--futuristic-shadow);
      font-stretch: condensed;
      color: #C71585;
      background: none;
      -webkit-background-clip: initial;
      -webkit-text-fill-color: #C71585;
    }
    .ice-scatter span {
      display: inline-block;
      font-style: inherit;
      font-weight: inherit;
      font-family: inherit;
      letter-spacing: inherit;
      text-shadow: none;
      color: #C71585;
    }
    .tabs-section {
      text-align: center;
      margin-top: 14px;
      margin-bottom: 0;
    }
    .tabs {
      display: inline-flex;
      gap: 1.2rem;
      margin-bottom: 0;
    }
    .tab {
      padding: 0.5rem 1.7rem;
      font-size: 1.15rem;
      background: var(--tab-bg);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      font-weight: 700;
      font-style: italic;
      outline: none;
      margin-bottom: 0.5rem;
      color: var(--tab-unselected-font);
      box-shadow: 0 0 6px #DE5C9A88;
      letter-spacing: 0.07em;
      transition: background 0.15s, color 0.15s, box-shadow 0.3s;
      position: relative;
      overflow: hidden;
      border: none;
    }
    .tab.active {
      color: var(--tab-selected-font);
      background: var(--tab-selected-bg);
      box-shadow: 0 0 12px #C7007F, 0 0 6px #DE5C9A;
      text-shadow: 0 0 3px #fff, 0 0 6px #DE5C9A;
    }
    .tab:not(.active):hover {
      background: var(--tab-hover-bg);
      color: var(--accent);
      box-shadow: 0 0 8px #B30073;
    }
    main {
      margin-top: 26px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 1rem 2rem 1rem;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #fff;
      border-radius: 12px;
      background: transparent;
      box-shadow: 0 0 24px #DE5C9A44;
      backdrop-filter: blur(2px);
    }
    .table-container {
      width: 100%;
      overflow-x: auto;
      background: var(--table-bg);
      border-radius: 14px;
      box-shadow: 0 2px 18px #B3007366;
      margin-top: 2.5rem;
      border: none;
    }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      min-width: 380px;
      font-size: 1.08rem;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #fff;
      background: transparent;
      box-shadow: 0 0 10px #DE5C9A44;
      border-radius: 14px;
      overflow: hidden;
    }
    thead {
      background: var(--table-bg);
      position: sticky;
      top: 0;
    }
    th, td {
      padding: 0.9rem 1rem;
      text-align: left;
      white-space: nowrap;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #fff !important;
      letter-spacing: 0.07em;
      border: none;
    }
    th {
      font-weight: 800;
      font-size: 1.08rem;
      background: var(--table-bg);
      color: #FFD1DC !important;
      text-shadow: 0 0 8px #DE5C9A, 0 0 4px #C7007F;
      border: none;
    }
    tbody tr:nth-child(even) {
      background: var(--row-even);
      transition: background 0.2s;
      border: none;
    }
    tbody tr:nth-child(odd) {
      background: var(--row-odd);
      transition: background 0.2s;
      border: none;
    }
    tbody tr:hover {
      background: var(--row-accent);
      color: #fff;
      box-shadow: 0 0 8px #DE5C9A;
      transition: background 0.2s, color 0.2s;
      border: none;
    }
    .spinner,
    .loading-message,
    .error-message {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2.5rem auto;
      min-height: 120px;
      font-size: 1.24rem;
      color: #FFD1DC;
      font-family: Cambria, 'Segoe UI', 'Roboto', Arial, sans-serif;
      font-weight: 600;
      text-align: center;
      text-shadow: 0 0 8px #DE5C9A, 0 0 4px #B30073;
      letter-spacing: 0.1em;
      background: var(--table-bg);
      border-radius: 12px;
      box-shadow: 0 0 12px #B3007344;
      border: none;
    }
    .spinner::after {
      content: '';
      display: inline-block;
      width: 32px;
      height: 32px;
      border: 4px solid #DE5C9A;
      border-radius: 50%;
      border-top: 4px solid transparent;
      animation: spin 1s linear infinite;
      margin-left: 12px;
      vertical-align: middle;
      box-shadow: 0 0 16px #B30073;
      border: none;
    }
    @keyframes spin {
      100% { transform: rotate(360deg);}
    }
    @media (max-width: 700px) {
      header h1 { font-size: 2rem; }
      nav { height: 52px; }
      main { margin-top: 40px; }
      th, td { padding: 0.6rem 0.5rem; font-size: 0.95rem;}
      .tab { font-size: 1rem; padding: 0.45rem 1rem;}
      .ice-scatter { font-size: 1.6rem; padding: 0.12rem 0.4rem;}
    }
    @media (max-width: 430px) {
      .table-container { padding: 0; }
      th, td { font-size: 0.9rem;}
      .tab { padding: 0.35rem 0.7rem; font-size: 0.93rem;}
      header { padding-top: 70px; }
      .ice-scatter { font-size: 1.2rem; padding: 0.08rem 0.2rem;}
    }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title" class="ice-scatter">
      <span style="color:#C71585;">I</span>
      <span style="color:#C71585;">C</span>
      <span style="color:#C71585;">E</span>
      <span style="color:#C71585;"> </span>
      <span style="color:#C71585;">B</span>
      <span style="color:#C71585;">r</span>
      <span style="color:#C71585;">a</span>
      <span style="color:#C71585;">k</span>
      <span style="color:#C71585;">i</span>
      <span style="color:#C71585;">n</span>
      <span style="color:#C71585;">g</span>
    </h1>
    <div class="tabs-section">
      <div class="tabs">
        <button class="tab active" id="tab-drivers" type="button">D</button>
        <button class="tab" id="tab-constructors" type="button">C</button>
      </div>
    </div>
  </header>
  <main>
    <div id="content">
      <div class="spinner" id="loading">Loading standings...</div>
    </div>
  </main>
  <script>
    // --- CONFIG ---
    const API = {
      drivers: 'https://api.jolpi.ca/ergast/f1/current/driverStandings.json',
      constructors: 'https://api.jolpi.ca/ergast/f1/current/constructorStandings.json'
    };
    const CACHE_TTL = 300; // seconds (5 min)

    // --- DOM ---
    const tabs = {
      drivers: document.getElementById('tab-drivers'),
      constructors: document.getElementById('tab-constructors')
    };
    const content = document.getElementById('content');
    const siteTitle = document.getElementById('site-title');
    let activeTab = 'drivers';

    // --- Caching helpers ---
    function cacheKey(type) { return `f1_${type}_standings`; }
    function getCache(type) {
      try {
        const item = localStorage.getItem(cacheKey(type));
        if (!item) return null;
        const { data, ts } = JSON.parse(item);
        if (Date.now()/1000 - ts > CACHE_TTL) return null;
        return data;
      } catch { return null; }
    }
    function setCache(type, data) {
      try {
        localStorage.setItem(cacheKey(type), JSON.stringify({ data, ts: Math.floor(Date.now()/1000) }));
      } catch {}
    }

    // --- Team renaming logic ---
    function renameTeam(name) {
      if (name === 'Red Bull') return 'Red Bull Racing';
      if (name === 'RB F1 Team') return 'Racing Bulls';
      if (name === 'Sauber') return 'Kick Sauber';
      if (name === 'Alpine F1 Team') return 'Alpine';
      return name;
    }

    // --- Render ---
    function showLoading(msg='Loading standings...') {
      content.innerHTML = `<div class="spinner">${msg}</div>`;
    }
    function showError(msg='Unable to load standings') {
      content.innerHTML = `<div class="error-message">${msg}</div>`;
    }

    function renderTable(type, items) {
      let html = '';
      if (type === 'drivers') {
        html += `<div class="table-container"><table><thead>
          <tr>
            <th>Position</th>
            <th>Name</th>
            <th>Team</th>
            <th>Points</th>
          </tr></thead><tbody>`;
        for (const item of items) {
          // Custom team logic for Yuki Tsunoda and Liam Lawson
          let teamName;
          if (item.name === "Yuki Tsunoda") {
            teamName = "Red Bull Racing";
          } else if (item.name === "Liam Lawson") {
            teamName = "Racing Bulls";
          } else {
            teamName = renameTeam(item.team);
          }
          html += `<tr>
            <td>${item.position}</td>
            <td>${item.name}</td>
            <td>${teamName}</td>
            <td>${item.points}</td>
          </tr>`;
        }
        html += `</tbody></table></div>`;
      } else if (type === 'constructors') {
        html += `<div class="table-container"><table><thead>
          <tr>
            <th>Position</th>
            <th>Name</th>
            <th>Points</th>
          </tr></thead><tbody>`;
        for (const item of items) {
          html += `<tr>
            <td>${item.position}</td>
            <td>${renameTeam(item.name)}</td>
            <td>${item.points}</td>
          </tr>`;
        }
        html += `</tbody></table></div>`;
      }
      content.innerHTML = html;
    }

    // --- Data parsing ---
    function parseDrivers(json) {
      try {
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if (!lists || !lists.length) return [];
        const drivers = lists[0]?.DriverStandings || [];
        return drivers.map(d => ({
          position: d.positionText || d.position || '-',
          name: `${d.Driver.givenName} ${d.Driver.familyName}`,
          team: d.Constructors[0]?.name || '',
          points: d.points
        }));
      } catch { return []; }
    }
    function parseConstructors(json) {
      try {
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if (!lists || !lists.length) return [];
        const constructors = lists[0]?.ConstructorStandings || [];
        return constructors.map(c => ({
          position: c.positionText || c.position || '-',
          name: c.Constructor?.name || '-',
          points: c.points
        }));
      } catch { return []; }
    }

    // --- Fetch ---
    async function fetchStandings(type) {
      let cached = getCache(type);
      if (cached) return cached;
      showLoading();
      try {
        const url = API[type];
        const resp = await fetch(url);
        if (!resp.ok) throw new Error('Network error');
        const json = await resp.json();
        let items = [];
        if (type === 'drivers') items = parseDrivers(json);
        else items = parseConstructors(json);
        if (!items.length) throw new Error('No data');
        setCache(type, items);
        return items;
      } catch {
        showError();
        return null;
      }
    }

    // --- Tab logic ---
    function setTabInURL(type) {
      history.replaceState(null, '', '#' + type);
    }

    async function switchTab(type) {
      if (activeTab === type) return;
      activeTab = type;
      tabs.drivers.classList.toggle('active', type === 'drivers');
      tabs.constructors.classList.toggle('active', type === 'constructors');
      setTabInURL(type);
      showLoading();
      let items = getCache(type);
      if (!items) items = await fetchStandings(type);
      if (!items || !items.length) {
        showError();
        return;
      }
      renderTable(type, items);
    }

    function initialLoad() {
      let tabType = 'drivers';
      if (location.hash === '#constructors') tabType = 'constructors';
      activeTab = tabType;
      tabs.drivers.classList.toggle('active', tabType === 'drivers');
      tabs.constructors.classList.toggle('active', tabType === 'constructors');
      setTabInURL(tabType);
      showLoading();
      fetchStandings(tabType).then(items => {
        if (!items || !items.length) {
          showError();
          return;
        }
        renderTable(tabType, items);
      });
    }

    tabs.drivers.addEventListener('click', () => {
      if (activeTab !== 'drivers') switchTab('drivers');
    });
    tabs.constructors.addEventListener('click', () => {
      if (activeTab !== 'constructors') switchTab('constructors');
    });

    window.addEventListener('DOMContentLoaded', initialLoad);
  </script>
</body>
</html>