<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>F1 Standings</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root{
      --bg: #000;
      --muted: rgba(255,255,255,0.08);
      --muted-2: rgba(255,255,255,0.03);
      --accent: #fff;
      --accent-strong: rgba(255,255,255,0.95);
      --gap: 20px;
      --max-width: 1100px;
      --year-col-w: 160px;
      --tabs-col-w: 160px;
      --year-item-h: 48px;
      --radius: 10px;
      --shadow: 0 10px 30px rgba(0,0,0,0.6);

      /* unified selected styling for both tab and year */
      --selected-bg: rgba(255,255,255,0.14);
      --selected-glow: 0 12px 36px rgba(255,255,255,0.10), 0 2px 8px rgba(0,0,0,0.6);
    }

    /* Page */
    html,body{
      height:100%;
      margin:0;
      padding:0;
      background: var(--bg);
      color: var(--accent);
      font-family: "Copperplate Gothic","Copperplate","Copperplate Gothic Bold","Copperplate Gothic Light", serif;
      font-weight:700;
      text-transform:uppercase;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      letter-spacing:0.02em;
      box-sizing:border-box;
    }
    *, *::before, *::after { box-sizing: inherit; }

    /* Visually hide global scrollbars except where shown */
    * { scrollbar-width: none; -ms-overflow-style: none; }
    *::-webkit-scrollbar { display: none; width: 0; height: 0; }

    a { color: inherit; text-decoration: none; }
    :focus { outline: none; }

    /* Page layout */
    .page {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: var(--gap);
      padding: 20px;
    }

    /* Controls row sits above the table; centered, symmetric */
    .controls-row {
      width:100%;
      max-width: var(--max-width);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 24px;
      padding: 8px;
    }

    /* Year column (left) */
    .year-column {
      width: var(--year-col-w);
      min-width: var(--year-col-w);
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:stretch;
    }
    .year-label{
      font-size:0.8rem;
      color: rgba(255,255,255,0.85);
      letter-spacing:0.08em;
      text-align:center;
    }
    .year-list {
      height: calc(var(--year-item-h) * 3); /* show 3 at a time */
      overflow-y:auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius: var(--radius);
      padding:6px;
      border: 1px solid rgba(255,255,255,0.03);
      box-shadow: var(--shadow);
      scroll-behavior: smooth; /* smooth centering */
    }
    /* show scrollbar for year list */
    .year-list::-webkit-scrollbar { width:10px; }
    .year-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.14); border-radius:8px; }
    .year-list::-webkit-scrollbar-track { background: transparent; }

    .year-item {
      height: var(--year-item-h);
      line-height: var(--year-item-h);
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:8px;
      margin: 4px 0;
      color: rgba(255,255,255,0.9);
      cursor:pointer;
      transition: transform .08s ease, background .12s ease, color .12s ease;
      user-select: none;
      font-size: 0.95rem;
      text-align:center;
      background: transparent;
      /* ensure year text looks bold as requested */
      font-family: "Copperplate Gothic Bold","Copperplate Gothic","Copperplate", serif;
      font-weight: 800;
    }
    .year-item:hover { transform: translateY(-3px); background: rgba(255,255,255,0.02); color: var(--accent-strong); }
    .year-item.selected {
      /* use unified selected look */
      background: var(--selected-bg);
      color: var(--accent-strong);
      box-shadow: var(--selected-glow);
    }
    .year-item:focus-visible { outline: 3px solid rgba(255,255,255,0.12); outline-offset:3px; border-radius:6px; }

    /* Tabs column (right) */
    .tabs-column {
      width: var(--tabs-col-w);
      min-width: var(--tabs-col-w);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }
    .tab {
      padding: 10px 12px;
      background: var(--muted-2);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      transition: transform .08s ease, background .12s ease, box-shadow .12s ease;
      text-align:center;
      font-size:0.95rem;
      /* ensure tab label is pure white and Copperplate Gothic Bold */
      color: #ffffff;
      font-family: "Copperplate Gothic Bold","Copperplate Gothic","Copperplate", serif;
      font-weight: 800;
    }
    .tab:hover { transform: translateY(-3px); background: rgba(255,255,255,0.04); }
    /* stronger brighter grey glow and brighter background when selected - use unified selected look */
    .tab.active {
      background: var(--selected-bg);
      box-shadow: var(--selected-glow);
      color: #ffffff; /* keep label white */
      transform: translateY(-4px);
    }
    .tab:focus-visible { outline: 3px solid rgba(255,255,255,0.18); outline-offset:3px; border-radius:8px; }

    /* Main content area */
    main {
      width:100%;
      max-width: var(--max-width);
      padding: 8px;
      box-sizing:border-box;
    }

    .table-container {
      width:100%;
      overflow:auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.03);
      padding: 10px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.6);
    }

    table {
      width:100%;
      border-collapse: separate;
      border-spacing:0;
      min-width: 420px;
      font-size: 1.02rem;
      color:var(--accent);
      text-transform:uppercase;
    }
    thead { position: sticky; top:0; background:rgba(255,255,255,0.02); }
    th,td{
      padding: 10px 12px;
      text-align:left;
      white-space:nowrap;
      font-weight:700;
      color:var(--accent);
    }
    tbody tr:nth-child(odd) { background: rgba(255,255,255,0.012); }
    tbody tr:nth-child(even) { background: rgba(255,255,255,0.02); }
    tbody tr:hover { background: rgba(255,255,255,0.04); }

    .spinner, .error-message {
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 120px;
      padding: 18px;
      font-size:1.1rem;
      border-radius:10px;
      background: rgba(255,255,255,0.015);
      border:1px solid rgba(255,255,255,0.02);
    }
    .spinner::after{
      content:'';
      display:inline-block;
      width:28px;height:28px;border:4px solid rgba(255,255,255,0.12);border-top-color:transparent;border-radius:50%;margin-left:12px;animation: spin 1s linear infinite;
    }
    @keyframes spin {100%{transform:rotate(360deg)}}

    .team-link-table { color:var(--accent); text-decoration:underline; }
    .team-link-table:hover { color:var(--accent-strong); }

    /* Footer home button */
    .home-wrap{ margin-top:18px; padding-left:6px; }
    .home-btn{
      display:inline-flex; align-items:center; justify-content:center;
      width:48px; height:48px; border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.03);
    }
    .home-btn:hover{ transform:translateY(-3px); background:rgba(255,255,255,0.04); }
    .home-btn:focus-visible{ outline:3px solid rgba(255,255,255,0.12); outline-offset:4px; border-radius:8px; }

    /* Responsive: stack controls on small screens */
    @media (max-width: 880px){
      .controls-row { flex-direction:row; align-items:flex-start; justify-content:space-between; gap:12px; }
      .year-column, .tabs-column { width: 140px; min-width:140px; }
      main { margin-top: 6px; }
    }
    @media (max-width: 660px){
      .controls-row { flex-direction:column; align-items:center; gap:12px; }
      .year-column, .tabs-column { width: 100%; min-width: auto; display:flex; align-items:center; justify-content:center; }
      .year-list { width: 80%; display:flex; gap:8px; overflow-x:auto; overflow-y:hidden; height: calc(40px * 1.2); }
      .year-item { min-width: 72px; height:40px; line-height:40px; margin:0 6px; }
      .tabs-column { flex-direction:row; gap:8px; }
      .tabs-column .tab{ width:auto; padding:8px 12px; }
      main { padding: 0 12px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Controls row above the table -->
    <div class="controls-row" role="region" aria-label="Controls">
      <!-- Year selector (left) -->
      <div class="year-column" aria-label="Season year selector">
        <div class="year-label">Year</div>
        <div id="yearList" class="year-list" role="listbox" tabindex="0" aria-label="Choose year"></div>
      </div>

      <!-- (Empty center to keep symmetry; table sits below) -->
      <div style="flex:1"></div>

      <!-- Tabs (right) -->
      <div class="tabs-column" role="tablist" aria-label="Standings tabs">
        <button id="tabDrivers" class="tab" role="tab" aria-selected="true">DRIVERS</button>
        <button id="tabConstructors" class="tab" role="tab" aria-selected="false">CONSTRUCTORS</button>
      </div>
    </div>

    <!-- Main content: table below controls -->
    <main>
      <div id="content">
        <div class="spinner" id="loading">LOADING STANDINGS...</div>
      </div>

      <div class="home-wrap">
        <a href="index.html" class="home-btn" aria-label="Home" title="Home">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" aria-hidden="true">
            <path d="M12 3l9 8h-3v7a1 1 0 0 1-1 1h-4v-5H11v5H7a1 1 0 0 1-1-1v-7H3l9-8z"/>
          </svg>
        </a>
      </div>
    </main>
  </div>

  <script>
    // API base and cache TTL
    const API_BASE = 'https://api.jolpi.ca/ergast/f1/';
    const CACHE_TTL = 300; // 5 minutes

    // DOM
    const yearListEl = document.getElementById('yearList');
    const content = document.getElementById('content');
    const tabDrivers = document.getElementById('tabDrivers');
    const tabConstructors = document.getElementById('tabConstructors');

    // state
    const firstYear = 1950;
    const currentYear = (new Date()).getFullYear(); // e.g., 2025
    let selectedYear = currentYear;
    let activeTab = 'drivers';

    // team links map
    const constructorTeamLinks = {
      "McLaren": "https://www.icebraking.com/McLaren/mclaren.html",
      "Mercedes": "https://www.icebraking.com/Mercedes/mercedes.html",
      "Ferrari": "https://www.icebraking.com/Ferrari/ferrari.html",
      "Red Bull Racing": "https://www.icebraking.com/RedBullRacing/redbullracing.html",
      "Williams": "https://www.icebraking.com/Williams/williams.html",
      "Racing Bulls": "https://www.icebraking.com/RacingBulls/racingbulls.html",
      "Aston Martin": "https://www.icebraking.com/AstonMartin/astonmartin.html",
      "Kick Sauber": "https://www.icebraking.com/KickSauber/kicksauber.html",
      "Haas F1 Team": "https://www.icebraking.com/HaasF1Team/haasf1team.html",
      "Alpine": "https://www.icebraking.com/Alpine/alpine.html",
      "RED BULL RACING": "https://www.icebraking.com/RedBullRacing/redbullracing.html",
      "RACING BULLS": "https://www.icebraking.com/RacingBulls/racingbulls.html",
      "KICK SAUBER": "https://www.icebraking.com/KickSauber/kicksauber.html",
      "ALPINE": "https://www.icebraking.com/Alpine/alpine.html"
    };

    // caching helpers
    function cacheKey(type, year){ return `f1_${type}_standings_${year}`; }
    function getCache(type, year){
      try{
        const item = localStorage.getItem(cacheKey(type, year));
        if(!item) return null;
        const {data, ts} = JSON.parse(item);
        if(Date.now()/1000 - ts > CACHE_TTL) return null;
        return data;
      }catch{ return null; }
    }
    function setCache(type, year, data){
      try{ localStorage.setItem(cacheKey(type, year), JSON.stringify({ data, ts: Math.floor(Date.now()/1000) })); }catch{}
    }

    // helpers
    function renameTeam(name){
      if(name === 'Red Bull') return 'RED BULL RACING';
      if(name === 'RB F1 Team') return 'RACING BULLS';
      if(name === 'Sauber') return 'KICK SAUBER';
      if(name === 'Alpine F1 Team') return 'ALPINE';
      return (name||'').toUpperCase();
    }

    function showLoading(msg='LOADING STANDINGS...'){
      content.innerHTML = `<div class="spinner">${msg}</div>`;
    }
    function showError(msg='UNABLE TO LOAD STANDINGS'){
      content.innerHTML = `<div class="error-message">${msg}</div>`;
    }

    function renderTable(type, items){
      let html = '';
      if(type === 'drivers'){
        // only render links when selectedYear is 2025
        const allowLinks = (Number(selectedYear) === 2025);
        html += `<div class="table-container"><table><thead><tr><th>POSITION</th><th>NAME</th><th>TEAM</th><th>POINTS</th></tr></thead><tbody>`;
        for(const item of items){
          let teamName;
          if(item.name === "Yuki Tsunoda") teamName = "RED BULL RACING";
          else if(item.name === "Liam Lawson") teamName = "RACING BULLS";
          else teamName = renameTeam(item.team);

          const teamLink = constructorTeamLinks[teamName] || constructorTeamLinks[item.team] || constructorTeamLinks[(item.team || '')];

          const teamCell = (allowLinks && teamLink)
            ? `<a class="team-link-table" href="${teamLink}" target="_blank" rel="noopener">${teamName}</a>`
            : teamName;

          html += `<tr><td>${item.position}</td><td>${(item.name||'').toUpperCase()}</td><td>${teamCell}</td><td>${item.points}</td></tr>`;
        }
        html += `</tbody></table></div>`;
      } else {
        // constructors - links allowed only for year 2025 per request
        const allowLinks = (Number(selectedYear) === 2025);
        html += `<div class="table-container"><table><thead><tr><th>POSITION</th><th>NAME</th><th>POINTS</th></tr></thead><tbody>`;
        for(const item of items){
          const displayName = renameTeam(item.name);
          const link = constructorTeamLinks[displayName] || constructorTeamLinks[item.name] || constructorTeamLinks[(item.name || '')];
          const nameCell = (allowLinks && link)
            ? `<a class="team-link-table" href="${link}" target="_blank" rel="noopener">${displayName}</a>`
            : displayName;
          html += `<tr><td>${item.position}</td><td>${nameCell}</td><td>${item.points}</td></tr>`;
        }
        html += `</tbody></table></div>`;
      }
      content.innerHTML = html;
    }

    function parseDrivers(json){
      try{
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if(!lists || !lists.length) return [];
        const drivers = lists[0]?.DriverStandings || [];
        return drivers.map(d => ({
          position: d.positionText || d.position || '-',
          name: `${d.Driver.givenName} ${d.Driver.familyName}`,
          team: d.Constructors[0]?.name || '',
          points: d.points
        }));
      }catch{ return []; }
    }
    function parseConstructors(json){
      try{
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if(!lists || !lists.length) return [];
        const constructors = lists[0]?.ConstructorStandings || [];
        return constructors.map(c => ({
          position: c.positionText || c.position || '-',
          name: c.Constructor?.name || '-',
          points: c.points
        }));
      }catch{ return []; }
    }

    async function fetchStandings(type, year){
      const cached = getCache(type, year);
      if(cached) return cached;
      showLoading();
      try{
        const endpoint = type === 'drivers' ? 'driverStandings.json' : 'constructorStandings.json';
        const url = `${API_BASE}${year}/${endpoint}`;
        const resp = await fetch(url);
        if(!resp.ok) throw new Error('Network error');
        const json = await resp.json();
        const items = type === 'drivers' ? parseDrivers(json) : parseConstructors(json);
        if(!items.length) throw new Error('No data');
        setCache(type, year, items);
        return items;
      }catch(err){
        console.error(err);
        showError();
        return null;
      }
    }

    // Build year list (descending)
    function buildYearList(){
      const frag = document.createDocumentFragment();
      for(let y = currentYear; y >= firstYear; y--){
        const div = document.createElement('div');
        div.className = 'year-item';
        div.setAttribute('role','option');
        div.setAttribute('data-year', String(y));
        div.tabIndex = 0;
        div.textContent = String(y);
        div.addEventListener('click', ()=> selectYear(y, true));
        div.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectYear(y, true); }
          if(e.key === 'ArrowUp') { e.preventDefault(); focusYearOffset(-1); }
          if(e.key === 'ArrowDown') { e.preventDefault(); focusYearOffset(1); }
        });
        frag.appendChild(div);
      }
      yearListEl.appendChild(frag);
    }
    function focusYearOffset(offset){
      const items = Array.from(yearListEl.querySelectorAll('.year-item'));
      const idx = items.findIndex(i => i.classList.contains('selected'));
      let target = idx + offset;
      if(target < 0) target = 0;
      if(target >= items.length) target = items.length -1;
      items[target].focus();
    }

    function selectYear(year, shouldFetch = true){
      selectedYear = year;
      const items = Array.from(yearListEl.querySelectorAll('.year-item'));
      items.forEach(it => it.classList.toggle('selected', Number(it.getAttribute('data-year')) === year));
      const selectedEl = yearListEl.querySelector(`.year-item[data-year="${year}"]`);
      if(selectedEl){
        // center the selected element within the visible area (adjacent years above and below)
        const container = yearListEl;
        const containerHeight = container.clientHeight;
        const elOffsetTop = selectedEl.offsetTop;
        const elHeight = selectedEl.offsetHeight;
        const scrollTo = elOffsetTop - (containerHeight / 2) + (elHeight / 2);
        // use smooth scrolling when available
        if ('scrollTo' in container) {
          container.scrollTo({ top: Math.max(0, Math.round(scrollTo)), behavior: 'smooth' });
        } else {
          container.scrollTop = Math.max(0, Math.round(scrollTo));
        }
      }
      if(shouldFetch) loadForCurrentState();
    }

    function setActiveTab(tab){
      activeTab = tab;
      tabDrivers.classList.toggle('active', tab === 'drivers');
      tabConstructors.classList.toggle('active', tab === 'constructors');
      tabDrivers.setAttribute('aria-selected', tab === 'drivers' ? 'true' : 'false');
      tabConstructors.setAttribute('aria-selected', tab === 'constructors' ? 'true' : 'false');

      // keep selected tab and selected year visually consistent (both use same selected look)
      // (year selection styling is already applied in selectYear)

      loadForCurrentState();
    }

    async function loadForCurrentState(){
      showLoading();
      const items = await fetchStandings(activeTab, selectedYear);
      if(!items || !items.length) { showError(); return; }
      renderTable(activeTab, items);
    }

    tabDrivers.addEventListener('click', ()=> { if(activeTab !== 'drivers') setActiveTab('drivers'); });
    tabConstructors.addEventListener('click', ()=> { if(activeTab !== 'constructors') setActiveTab('constructors'); });

    // initial
    function init(){
      buildYearList();
      // highlight and center current year
      selectYear(currentYear, false); // highlight current year without fetching twice
      setActiveTab('drivers'); // will call loadForCurrentState
      setTimeout(()=> loadForCurrentState(), 50);
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>