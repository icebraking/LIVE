<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ICE Braking | F1 Standings</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root {
      --tab-bg: rgba(255,255,255,0.08);
      --tab-selected-bg: rgba(255,255,255,0.06);
      --tab-hover-bg: rgba(255,255,255,0.05);
      --table-bg: rgba(255,255,255,0.03);
      --row-even: rgba(255,255,255,0.02);
      --row-odd: rgba(255,255,255,0.015);
      --row-accent: rgba(255,255,255,0.04);
      --accent: #FFFFFF;
    }

    /* UNIVERSAL COPPERPLATE GOTHIC, WHITE, UPPERCASE, BOLD */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #000000; /* pure black background for entire page */
      color: #FFFFFF; /* white font */
      font-family: "Copperplate Gothic", "Copperplate", "Copperplate Gothic Light", "Copperplate Gothic Bold", "Copperplate", serif;
      font-weight: 700; /* bold */
      text-transform: uppercase; /* capitalize all alphabets (uppercase) */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      letter-spacing: 0.02em;
      overflow-x: hidden;
    }

    /* Hide scrollbars for extra safety */
    * { scrollbar-width: none; -ms-overflow-style: none; }
    *::-webkit-scrollbar { display: none; width: 0; height: 0; }

    a { color: inherit; text-decoration: none; }
    :focus { outline: none; }

    /* Header and tabs */
    header {
      text-align: center;
      padding: 80px 1rem 0.5rem 1rem;
      margin: 0;
    }
    .ice-scatter {
      font-size: 2rem;
      font-style: italic;
      margin: 0 0 0.3rem 0;
      border-radius: 14px;
      padding: 0.12rem 0.4rem;
      display: inline-block;
      color: #FFFFFF;
      background: transparent;
      -webkit-text-fill-color: #FFFFFF;
    }
    .tabs-section {
      text-align: center;
      margin-top: 14px;
      margin-bottom: 0;
    }
    .tabs {
      display: inline-flex;
      gap: 1.2rem;
      margin-bottom: 0;
    }
    /* Ensure tabs use Copperplate Gothic bold explicitly and remain uppercase */
    .tab {
      padding: 0.5rem 1.7rem;
      font-size: 1.15rem;
      background: var(--tab-bg);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      outline: none;
      margin-bottom: 0.5rem;
      color: var(--accent);
      letter-spacing: 0.07em;
      transition: background 0.15s, color 0.15s, box-shadow 0.3s;
      position: relative;
      overflow: hidden;
      font-family: "Copperplate Gothic","Copperplate",serif;
      font-weight: 800; /* bold for the DRIVERS and CONSTRUCTORS icons */
      text-transform: uppercase;
    }
    .tab.active {
      color: var(--accent);
      background: var(--tab-selected-bg);
      box-shadow: 0 0 8px rgba(255,255,255,0.04);
    }
    .tab:not(.active):hover {
      background: var(--tab-hover-bg);
      color: var(--accent);
      box-shadow: 0 0 6px rgba(255,255,255,0.03);
    }

    /* Main content */
    main {
      margin-top: 26px;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 1rem 2rem 1rem;
      color: #FFFFFF;
      border-radius: 12px;
      background: transparent;
    }

    .table-container {
      width: 100%;
      overflow-x: auto;
      background: var(--table-bg);
      border-radius: 8px;
      margin-top: 2.5rem;
      border: none;
    }

    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      min-width: 380px;
      font-size: 1.08rem;
      color: #FFFFFF;
      background: transparent;
      border-radius: 8px;
      overflow: hidden;
      text-transform: uppercase; /* ensure table text is uppercase */
    }
    thead {
      background: var(--table-bg);
      position: sticky;
      top: 0;
    }
    th, td {
      padding: 0.9rem 1rem;
      text-align: left;
      white-space: nowrap;
      color: #FFFFFF !important;
      border: none;
      font-weight: 700;
    }
    th {
      font-size: 1.08rem;
      background: var(--table-bg);
      color: #FFFFFF !important;
      text-shadow: none;
      border: none;
    }
    tbody tr:nth-child(even) {
      background: var(--row-even);
      transition: background 0.2s;
      border: none;
    }
    tbody tr:nth-child(odd) {
      background: var(--row-odd);
      transition: background 0.2s;
      border: none;
    }
    tbody tr:hover {
      background: var(--row-accent);
      color: #fff;
      transition: background 0.2s, color 0.2s;
      border: none;
    }

    .spinner,
    .loading-message,
    .error-message {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2.5rem auto;
      min-height: 120px;
      font-size: 1.24rem;
      color: #FFFFFF;
      font-weight: 700;
      text-align: center;
      background: var(--table-bg);
      border-radius: 12px;
      border: none;
    }
    .spinner::after {
      content: '';
      display: inline-block;
      width: 32px;
      height: 32px;
      border: 4px solid rgba(255,255,255,0.12);
      border-radius: 50%;
      border-top: 4px solid transparent;
      animation: spin 1s linear infinite;
      margin-left: 12px;
      vertical-align: middle;
      border: none;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Team link styling (uppercase and white) */
    .team-link-table {
      color: #FFFFFF;
      text-decoration: underline;
      font-weight: 700;
    }
    .team-link-table:hover { color: #FFFFFF; }

    /* Home button: placed in document flow below the table, not floating */
    .home-wrap {
      display: flex;
      justify-content: flex-start; /* left aligned */
      margin-top: 1cm; /* at least 1cm below the last entry in the table */
      padding-left: 1rem;
    }
    .home-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 52px;
      height: 52px;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      color: #FFFFFF;
      text-decoration: none;
      transition: transform .12s ease, background .12s ease;
      border: 0;
    }
    .home-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.05); }
    .home-btn svg { width: 24px; height: 24px; fill: currentColor; }

    /* Responsive tweaks */
    @media (max-width: 700px) {
      header { padding-top: 70px; }
      th, td { padding: 0.6rem 0.5rem; font-size: 0.95rem; }
      .tab { font-size: 1rem; padding: 0.45rem 1rem; }
      .ice-scatter { font-size: 1.6rem; padding: 0.12rem 0.4rem; }
      .team-link-table { font-size: 0.96rem; }
      .home-wrap { margin-top: calc(12px + 1cm); padding-left: 12px; }
      .home-btn { width: 46px; height: 46px; }
    }
    @media (max-width: 430px) {
      .table-container { padding: 0; }
      th, td { font-size: 0.9rem; }
      .tab { padding: 0.35rem 0.7rem; font-size: 0.93rem; }
      header { padding-top: 60px; }
      .ice-scatter { font-size: 1.2rem; padding: 0.08rem 0.2rem; }
      .home-wrap { margin-top: calc(10px + 1cm); padding-left: 10px; }
      .home-btn { width: 44px; height: 44px; }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title" class="ice-scatter">
      ICE BRAKING
    </h1>
    <div class="tabs-section">
      <div class="tabs">
        <button class="tab active" id="tab-drivers" type="button">DRIVERS</button>
        <button class="tab" id="tab-constructors" type="button">CONSTRUCTORS</button>
      </div>
    </div>
  </header>
  <main>
    <div id="content">
      <div class="spinner" id="loading">LOADING STANDINGS...</div>
    </div>

    <!-- Home button placed in normal flow below the table (not floating) -->
    <div class="home-wrap" aria-hidden="false">
      <a href="index.html" class="home-btn" aria-label="Home">
        <!-- Simple home SVG icon -->
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M12 3l9 8h-3v7a1 1 0 0 1-1 1h-4v-5H11v5H7a1 1 0 0 1-1-1v-7H3l9-8z" />
        </svg>
      </a>
    </div>
  </main>

  <script>
    // --- CONFIG ---
    const API = {
      drivers: 'https://api.jolpi.ca/ergast/f1/current/driverStandings.json',
      constructors: 'https://api.jolpi.ca/ergast/f1/current/constructorStandings.json'
    };
    const CACHE_TTL = 300; // seconds (5 min)

    // --- DOM ---
    const tabs = {
      drivers: document.getElementById('tab-drivers'),
      constructors: document.getElementById('tab-constructors')
    };
    const content = document.getElementById('content');
    let activeTab = 'drivers';

    // Mapping of constructor display names to hyperlink URLs
    // Includes uppercase keys for renamed/uppercased team strings
    const constructorTeamLinks = {
      "McLaren": "https://www.icebraking.com/McLaren/mclaren.html",
      "Mercedes": "https://www.icebraking.com/Mercedes/mercedes.html",
      "Ferrari": "https://www.icebraking.com/Ferrari/ferrari.html",
      "Red Bull Racing": "https://www.icebraking.com/RedBullRacing/redbullracing.html",
      "Williams": "https://www.icebraking.com/Williams/williams.html",
      "Racing Bulls": "https://www.icebraking.com/RacingBulls/racingbulls.html",
      "Aston Martin": "https://www.icebraking.com/AstonMartin/astonmartin.html",
      "Kick Sauber": "https://www.icebraking.com/KickSauber/kicksauber.html",
      "Haas F1 Team": "https://www.icebraking.com/HaasF1Team/haasf1team.html",
      "Alpine": "https://www.icebraking.com/Alpine/alpine.html",
      "RED BULL RACING": "https://www.icebraking.com/RedBullRacing/redbullracing.html",
      "RACING BULLS": "https://www.icebraking.com/RacingBulls/racingbulls.html",
      "KICK SAUBER": "https://www.icebraking.com/KickSauber/kicksauber.html",
      "ALPINE": "https://www.icebraking.com/Alpine/alpine.html"
    };

    function cacheKey(type) { return `f1_${type}_standings`; }
    function getCache(type) {
      try {
        const item = localStorage.getItem(cacheKey(type));
        if (!item) return null;
        const { data, ts } = JSON.parse(item);
        if (Date.now()/1000 - ts > CACHE_TTL) return null;
        return data;
      } catch { return null; }
    }
    function setCache(type, data) {
      try {
        localStorage.setItem(cacheKey(type), JSON.stringify({ data, ts: Math.floor(Date.now()/1000) }));
      } catch {}
    }

    function renameTeam(name) {
      if (name === 'Red Bull') return 'RED BULL RACING';
      if (name === 'RB F1 Team') return 'RACING BULLS';
      if (name === 'Sauber') return 'KICK SAUBER';
      if (name === 'Alpine F1 Team') return 'ALPINE';
      return (name || '').toUpperCase();
    }

    function showLoading(msg='LOADING STANDINGS...') {
      content.innerHTML = `<div class="spinner">${msg}</div>`;
    }
    function showError(msg='UNABLE TO LOAD STANDINGS') {
      content.innerHTML = `<div class="error-message">${msg}</div>`;
    }

    function renderTable(type, items) {
      let html = '';
      if (type === 'drivers') {
        html += `<div class="table-container"><table><thead>
          <tr>
            <th>POSITION</th>
            <th>NAME</th>
            <th>TEAM</th>
            <th>POINTS</th>
          </tr></thead><tbody>`;
        for (const item of items) {
          let teamName;
          if (item.name === "Yuki Tsunoda") {
            teamName = "RED BULL RACING";
          } else if (item.name === "Liam Lawson") {
            teamName = "RACING BULLS";
          } else {
            teamName = renameTeam(item.team);
          }

          // Try to find a link for the team (supporting both uppercase and original keys)
          const teamLink = constructorTeamLinks[teamName] || constructorTeamLinks[item.team] || constructorTeamLinks[(item.team || '')];

          const teamCell = teamLink
            ? `<a class="team-link-table" href="${teamLink}" target="_blank" rel="noopener">${teamName}</a>`
            : teamName;

          html += `<tr>
            <td>${item.position}</td>
            <td>${(item.name || '').toUpperCase()}</td>
            <td>${teamCell}</td>
            <td>${item.points}</td>
          </tr>`;
        }
        html += `</tbody></table></div>`;
      } else if (type === 'constructors') {
        html += `<div class="table-container"><table><thead>
          <tr>
            <th>POSITION</th>
            <th>NAME</th>
            <th>POINTS</th>
          </tr></thead><tbody>`;
        for (const item of items) {
          const displayName = renameTeam(item.name);
          // Prefer mapping by uppercase display name, then original
          const link = constructorTeamLinks[displayName] || constructorTeamLinks[item.name] || constructorTeamLinks[(item.name || '')];
          const nameCell = link
            ? `<a class="team-link-table" href="${link}" target="_blank" rel="noopener">${displayName}</a>`
            : displayName;

          html += `<tr>
            <td>${item.position}</td>
            <td>${nameCell}</td>
            <td>${item.points}</td>
          </tr>`;
        }
        html += `</tbody></table></div>`;
      }
      content.innerHTML = html;
    }

    function parseDrivers(json) {
      try {
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if (!lists || !lists.length) return [];
        const drivers = lists[0]?.DriverStandings || [];
        return drivers.map(d => ({
          position: d.positionText || d.position || '-',
          name: `${d.Driver.givenName} ${d.Driver.familyName}`,
          team: d.Constructors[0]?.name || '',
          points: d.points
        }));
      } catch { return []; }
    }
    function parseConstructors(json) {
      try {
        const lists = json?.MRData?.StandingsTable?.StandingsLists;
        if (!lists || !lists.length) return [];
        const constructors = lists[0]?.ConstructorStandings || [];
        return constructors.map(c => ({
          position: c.positionText || c.position || '-',
          name: c.Constructor?.name || '-',
          points: c.points
        }));
      } catch { return []; }
    }

    async function fetchStandings(type) {
      let cached = getCache(type);
      if (cached) return cached;
      showLoading();
      try {
        const url = API[type];
        const resp = await fetch(url);
        if (!resp.ok) throw new Error('Network error');
        const json = await resp.json();
        let items = [];
        if (type === 'drivers') items = parseDrivers(json);
        else items = parseConstructors(json);
        if (!items.length) throw new Error('No data');
        setCache(type, items);
        return items;
      } catch {
        showError();
        return null;
      }
    }

    function setTabInURL(type) {
      history.replaceState(null, '', '#' + type);
    }

    async function switchTab(type) {
      if (activeTab === type) return;
      activeTab = type;
      tabs.drivers.classList.toggle('active', type === 'drivers');
      tabs.constructors.classList.toggle('active', type === 'constructors');
      setTabInURL(type);
      showLoading();
      let items = getCache(type);
      if (!items) items = await fetchStandings(type);
      if (!items || !items.length) {
        showError();
        return;
      }
      renderTable(type, items);
    }

    function initialLoad() {
      let tabType = 'drivers';
      if (location.hash === '#constructors') tabType = 'constructors';
      activeTab = tabType;
      tabs.drivers.classList.toggle('active', tabType === 'drivers');
      tabs.constructors.classList.toggle('active', tabType === 'constructors');
      setTabInURL(tabType);
      showLoading();
      fetchStandings(tabType).then(items => {
        if (!items || !items.length) {
          showError();
          return;
        }
        renderTable(tabType, items);
      });
    }

    tabs.drivers.addEventListener('click', () => {
      if (activeTab !== 'drivers') switchTab('drivers');
    });
    tabs.constructors.addEventListener('click', () => {
      if (activeTab !== 'constructors') switchTab('constructors');
    });

    window.addEventListener('DOMContentLoaded', initialLoad);
  </script>
</body>
</html>